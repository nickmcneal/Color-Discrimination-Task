<!-- <!DOCTYPE html> -->
<html>
  <head>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jquery-3.5.1.min.js"></script>
    <script src="jspsych/plugins/jspsych-blocks.js"></script>
    <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-blocks-exp.js"></script>
    <script src="jspsych/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych/plugins/jspsych-rainbow.js"></script>
    <script src="jspsych/plugins/jspsych-call-function.js"></script>
    <script src="jspsych/plugins/jspsych-reward-function.js"></script>
    <script src="jspsych/plugins/jspsych-call.js"></script>
    <script src="jspsych/plugins/jspsych-fullscreen.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych/plugins/jspsych-image-slider-response.js"></script>
    <link rel="stylesheet" href="jspsych/css/jspsych.css" />
  </head>
  <body></body>
  <script>
    var subject_id = jsPsych.randomization.randomID(9);
    var n = 5; //number of training trials
    var rep = 8; //number of experiment trials (MAX is 150)
    const fixation_duration = 500;

    // Fixation duration, this is also currently used if the participant selects
    // "Space" -- neither Left or Right -- and no border is shown
    // for their selection

    var timeline = [];
    var col1 = [];

    // Enter fullscreen:
    timeline.push({
      type: "fullscreen",
      fullscreen_mode: true,
    });

    var cursor_off = {
      type: "call-function",
      func: function () {
        document.body.style.cursor = "none";
      },
    };

    timeline.push(cursor_off);

    var cursor_on = {
      type: "call-function",
      func: function () {
        document.body.style.cursor = "auto";
      },
    };

    var fixedfirst = true;
    if (Math.random() > 0.5) {
      fixedfirst = true;
    } else {
      fixedfirst = false;
    }

    //Reward
    acc_reward = 27;

    var fixation = {
      type: "html-keyboard-response",
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: fixation_duration,
    };

    var pinktoblue = true;
    var bluetopink = false;
    var greentoorange = true;
    var orangetogreen = false;

    //pink to blue
    var colors = [
      "rgb(237,48,137)",
      "rgb(226,62,153)",
      "rgb(211,77,167)",
      "rgb(193.5,90,177.5)",
      "rgb(172,103,185)",
      "rgb(149,113.5,189)",
      "rgb(125,122,189)",
      "rgb(100,129.5,184.5)",
    ];

    //blue to pink
    if (Math.random() > 0.5) {
      colors.reverse();
      pinktoblue = false;
      bluetopink = true;
    }

    //green to orange
    var colors2 = [
      "rgb(82.5,142,91)",
      "rgb(100,140,73)",
      "rgb(117,137,56.5)",
      "rgb(134,133,41)",
      "rgb(152,127.5,28.5)",
      "rgb(169,120,20)",
      "rgb(186.5,111.5,19.5)",
      "rgb(202,101,27)",
    ];

    //orange to green
    if (Math.random() > 0.5) {
      greentoorange = false;
      orangetogreen = true;
      colors2.reverse();
    }

    var BPfirst = false;
    var GOfirst = false;

    if (Math.random() > 0.5) {
      col1 = colors; //BP
      BPfirst = true;
    } else {
      col1 = colors2; //GO
      GOfirst = true;
    }

    var log_rainbow = {
      type: "call",
      func: function () {},
      on_finish: function (data) {
        if (BPfirst) {
          if (bluetopink) {
            data.first_rainbow = "Blue to Pink";
          }
          if (pinktoblue) {
            data.first_rainbow = "Pink to Blue";
          }
          if (greentoorange) {
            data.second_rainbow = "Green to Orange";
          }
          if (orangetogreen) {
            data.second_rainbow = "Orange to Green";
          }
        }
        if (GOfirst) {
          if (greentoorange) {
            data.first_rainbow = "Green to Orange";
          }
          if (orangetogreen) {
            data.first_rainbow = "Orange to Green";
          }
          if (bluetopink) {
            data.second_rainbow = "Blue to Pink";
          }
          if (pinktoblue) {
            data.second_rainbow = "Pink to Blue";
          }
        }
      },
    };
    timeline.push(log_rainbow);
    var arr_left;

    //Code to generate arrays
    // var arrays = new Array();
    // for (var m = 0; m < 12; m++) {
    //   arrays[m] = new Array();
    // }
    // for (var x = 0; x < 2; x++) {
    //   for (var i = 0; i < 11; i++) {
    //     var arr = [];
    //     for (var j = 0; j < 6; j++) {
    //       arr[j] = Math.floor(Math.random() * 8);
    //       arrays[i][x] = arr;
    //     }
    //   }
    // }

    var arrays1 = [
      [
        [7, 2, 1, 0, 5, 0],
        [5, 6, 5, 5, 3, 2],
      ],
      [
        [1, 2, 5, 5, 5, 3],
        [4, 6, 2, 5, 1, 5],
      ],
      [
        [2, 1, 3, 2, 7, 3],
        [4, 2, 7, 2, 0, 7],
      ],
      [
        [5, 1, 3, 1, 5, 5],
        [6, 7, 0, 1, 0, 5],
      ],
      [
        [0, 3, 5, 2, 6, 4],
        [0, 4, 1, 5, 0, 7],
      ],
      [
        [5, 2, 4, 1, 4, 7],
        [4, 1, 5, 2, 3, 1],
      ],
      [
        [3, 4, 2, 7, 6, 7],
        [0, 5, 5, 6, 1, 7],
      ],
      [
        [5, 2, 0, 7, 4, 6],
        [5, 3, 4, 6, 2, 7],
      ],
      [
        [6, 6, 4, 1, 4, 6],
        [3, 3, 1, 6, 6, 4],
      ],
      [
        [4, 0, 6, 7, 5, 2],
        [5, 2, 7, 6, 7, 2],
      ],
      [
        [0, 3, 0, 4, 1, 6],
        [2, 2, 2, 1, 7, 5],
      ],
      [
        [0, 7, 6, 3, 6, 1],
        [0, 3, 0, 2, 7, 5],
      ],
      [
        [7, 2, 3, 5, 2, 0],
        [2, 1, 1, 1, 3, 4],
      ],
      [
        [1, 3, 5, 7, 0, 3],
        [1, 5, 4, 2, 6, 7],
      ],
      [
        [6, 5, 3, 1, 2, 5],
        [2, 2, 6, 0, 1, 3],
      ],
      [
        [7, 6, 6, 6, 5, 2],
        [0, 4, 3, 7, 6, 5],
      ],
      [
        [4, 7, 1, 1, 2, 0],
        [0, 3, 4, 5, 3, 3],
      ],
      [
        [0, 4, 4, 5, 2, 7],
        [2, 7, 4, 5, 0, 4],
      ],
      [
        [3, 5, 4, 5, 6, 1],
        [2, 3, 4, 3, 1, 6],
      ],
      [
        [1, 3, 0, 7, 1, 2],
        [0, 0, 3, 2, 2, 1],
      ],
      [
        [3, 3, 7, 4, 0, 5],
        [5, 2, 4, 2, 1, 6],
      ],
      [
        [2, 1, 4, 5, 3, 6],
        [7, 4, 3, 2, 3, 1],
      ],
      [
        [1, 2, 2, 2, 3, 2],
        [5, 1, 0, 0, 0, 1],
      ],
      [
        [2, 5, 6, 1, 1, 3],
        [4, 5, 2, 6, 2, 5],
      ],
      [
        [4, 3, 4, 1, 1, 0],
        [2, 2, 5, 4, 7, 2],
      ],
      [
        [7, 4, 5, 3, 1, 1],
        [5, 3, 0, 6, 3, 0],
      ],
      [
        [7, 2, 2, 1, 7, 1],
        [3, 3, 6, 4, 7, 0],
      ],
      [
        [5, 3, 7, 6, 5, 3],
        [3, 2, 7, 3, 5, 3],
      ],
      [
        [6, 6, 1, 3, 6, 7],
        [6, 1, 0, 1, 7, 1],
      ],
      [
        [4, 5, 4, 0, 7, 7],
        [5, 3, 6, 2, 5, 6],
      ],
      [
        [3, 7, 4, 3, 2, 7],
        [1, 6, 1, 5, 5, 0],
      ],
      [
        [2, 0, 1, 2, 6, 2],
        [1, 1, 3, 0, 5, 7],
      ],
      [
        [0, 4, 4, 1, 0, 1],
        [0, 6, 5, 2, 5, 0],
      ],
      [
        [2, 5, 6, 7, 3, 2],
        [5, 7, 1, 6, 4, 7],
      ],
      [
        [1, 2, 2, 1, 3, 5],
        [1, 1, 0, 6, 0, 3],
      ],
      [
        [0, 7, 2, 2, 1, 3],
        [3, 7, 5, 1, 4, 6],
      ],
      [
        [5, 2, 3, 7, 1, 1],
        [3, 3, 6, 6, 0, 3],
      ],
      [
        [1, 7, 7, 2, 4, 3],
        [2, 7, 3, 2, 1, 4],
      ],
      [
        [3, 4, 6, 0, 6, 1],
        [7, 2, 2, 7, 0, 2],
      ],
      [
        [2, 1, 2, 4, 0, 2],
        [7, 0, 5, 3, 2, 0],
      ],
      [
        [5, 1, 0, 6, 0, 0],
        [7, 1, 0, 0, 5, 0],
      ],
      [
        [7, 5, 0, 0, 0, 0],
        [3, 3, 0, 7, 4, 2],
      ],
      [
        [3, 0, 1, 7, 2, 0],
        [5, 3, 4, 6, 0, 3],
      ],
      [
        [5, 1, 5, 5, 7, 0],
        [3, 3, 0, 3, 5, 3],
      ],
      [
        [3, 4, 0, 2, 2, 4],
        [4, 5, 1, 6, 7, 5],
      ],
      [
        [4, 6, 2, 2, 2, 0],
        [2, 3, 2, 3, 7, 3],
      ],
      [
        [3, 3, 7, 6, 1, 7],
        [0, 5, 3, 6, 5, 5],
      ],
      [
        [0, 5, 3, 2, 0, 0],
        [4, 2, 5, 1, 6, 5],
      ],
      [
        [2, 3, 0, 3, 7, 0],
        [0, 1, 6, 7, 6, 4],
      ],
      [
        [2, 2, 2, 7, 3, 3],
        [0, 1, 1, 7, 0, 7],
      ],
      [
        [4, 0, 5, 7, 6, 0],
        [0, 4, 4, 3, 7, 7],
      ],
      [
        [5, 2, 2, 1, 5, 6],
        [7, 6, 7, 6, 2, 4],
      ],
      [
        [2, 6, 3, 4, 6, 2],
        [1, 5, 1, 5, 5, 5],
      ],
      [
        [4, 7, 1, 4, 2, 3],
        [6, 7, 6, 5, 4, 1],
      ],
      [
        [2, 4, 3, 2, 5, 5],
        [1, 3, 3, 2, 7, 5],
      ],
      [
        [6, 2, 6, 4, 4, 5],
        [3, 7, 0, 2, 2, 7],
      ],
      [
        [0, 5, 0, 7, 3, 5],
        [7, 4, 6, 3, 4, 4],
      ],
      [
        [4, 0, 5, 2, 5, 0],
        [6, 4, 7, 2, 3, 6],
      ],
      [
        [3, 3, 3, 4, 0, 1],
        [5, 4, 1, 0, 1, 2],
      ],
      [
        [7, 2, 1, 0, 3, 6],
        [2, 1, 5, 5, 1, 0],
      ],
      [
        [1, 7, 4, 4, 2, 6],
        [4, 5, 2, 2, 1, 2],
      ],
      [
        [3, 1, 7, 3, 0, 5],
        [4, 3, 5, 1, 5, 1],
      ],
      [
        [5, 1, 4, 7, 6, 4],
        [6, 2, 0, 4, 0, 0],
      ],
      [
        [2, 3, 2, 4, 4, 6],
        [4, 3, 5, 6, 7, 3],
      ],
      [
        [6, 1, 6, 4, 3, 7],
        [4, 1, 2, 6, 2, 7],
      ],
      [
        [2, 4, 0, 6, 5, 0],
        [4, 1, 6, 1, 1, 7],
      ],
      [
        [1, 2, 0, 2, 0, 1],
        [2, 5, 4, 4, 6, 0],
      ],
      [
        [4, 0, 0, 0, 1, 5],
        [0, 1, 5, 3, 0, 2],
      ],
      [
        [5, 4, 0, 6, 7, 4],
        [6, 6, 3, 1, 4, 3],
      ],
      [
        [3, 3, 7, 1, 6, 2],
        [7, 1, 3, 7, 7, 1],
      ],
      [
        [5, 6, 3, 6, 3, 2],
        [2, 6, 4, 2, 2, 3],
      ],
      [
        [7, 3, 1, 5, 1, 3],
        [0, 4, 0, 6, 4, 4],
      ],
      [
        [1, 7, 7, 4, 3, 6],
        [0, 3, 0, 5, 0, 3],
      ],
      [
        [7, 4, 0, 7, 2, 6],
        [0, 2, 1, 7, 4, 7],
      ],
      [
        [6, 6, 6, 7, 7, 4],
        [3, 6, 6, 7, 5, 0],
      ],
      [
        [5, 2, 4, 4, 7, 3],
        [0, 0, 3, 7, 0, 2],
      ],
      [
        [4, 6, 5, 1, 1, 1],
        [7, 7, 5, 0, 6, 4],
      ],
      [
        [0, 0, 0, 3, 6, 6],
        [4, 2, 6, 4, 0, 0],
      ],
      [
        [2, 3, 0, 5, 2, 3],
        [2, 6, 5, 0, 3, 7],
      ],
      [
        [5, 6, 7, 5, 5, 7],
        [0, 1, 1, 4, 4, 3],
      ],
      [
        [5, 7, 5, 7, 7, 2],
        [3, 7, 2, 4, 0, 1],
      ],
      [
        [7, 2, 5, 6, 0, 4],
        [6, 5, 0, 7, 0, 2],
      ],
      [
        [3, 0, 5, 4, 2, 3],
        [4, 2, 2, 4, 6, 2],
      ],
      [
        [3, 0, 6, 5, 2, 4],
        [3, 3, 4, 4, 2, 5],
      ],
      [
        [1, 3, 7, 1, 0, 6],
        [6, 0, 0, 2, 0, 6],
      ],
      [
        [3, 0, 0, 4, 5, 1],
        [7, 2, 1, 5, 3, 2],
      ],
      [
        [2, 7, 4, 3, 3, 6],
        [1, 3, 4, 0, 7, 1],
      ],
      [
        [1, 7, 5, 6, 0, 0],
        [7, 1, 5, 5, 4, 5],
      ],
      [
        [5, 7, 6, 4, 3, 7],
        [7, 3, 2, 1, 6, 5],
      ],
      [
        [4, 5, 5, 7, 0, 6],
        [0, 1, 1, 5, 3, 7],
      ],
      [
        [7, 7, 7, 7, 5, 5],
        [3, 7, 2, 2, 4, 1],
      ],
      [
        [6, 5, 4, 2, 0, 2],
        [6, 5, 4, 0, 1, 3],
      ],
      [
        [2, 3, 0, 4, 4, 2],
        [2, 4, 2, 2, 2, 0],
      ],
      [
        [3, 6, 7, 6, 5, 2],
        [2, 5, 1, 0, 5, 3],
      ],
      [
        [1, 5, 3, 6, 3, 6],
        [2, 5, 6, 5, 6, 7],
      ],
      [
        [1, 1, 1, 3, 4, 3],
        [3, 1, 0, 5, 2, 0],
      ],
      [
        [0, 4, 7, 2, 3, 4],
        [6, 1, 4, 5, 2, 5],
      ],
      [
        [6, 4, 6, 6, 5, 1],
        [2, 4, 7, 4, 6, 4],
      ],
      [
        [6, 7, 5, 2, 2, 5],
        [3, 7, 2, 1, 4, 0],
      ],
      [
        [1, 1, 2, 5, 2, 0],
        [3, 6, 1, 1, 3, 2],
      ],
      [
        [1, 4, 3, 7, 0, 3],
        [2, 7, 5, 2, 2, 0],
      ],
      [
        [6, 0, 1, 5, 2, 6],
        [1, 6, 2, 4, 4, 5],
      ],
      [
        [2, 5, 0, 1, 1, 4],
        [0, 7, 7, 3, 6, 7],
      ],
      [
        [2, 3, 0, 6, 4, 5],
        [0, 6, 1, 3, 6, 4],
      ],
      [
        [4, 1, 6, 2, 2, 7],
        [7, 2, 2, 4, 1, 4],
      ],
      [
        [6, 1, 1, 6, 6, 0],
        [4, 1, 5, 4, 1, 6],
      ],
      [
        [5, 5, 6, 7, 0, 5],
        [7, 1, 2, 5, 6, 0],
      ],
      [
        [3, 2, 6, 7, 3, 1],
        [0, 6, 3, 4, 0, 7],
      ],
      [
        [0, 5, 6, 4, 7, 1],
        [7, 4, 1, 2, 1, 3],
      ],
      [
        [5, 2, 6, 6, 7, 7],
        [1, 5, 1, 1, 2, 6],
      ],
      [
        [4, 2, 5, 5, 0, 0],
        [4, 6, 4, 1, 1, 5],
      ],
      [
        [6, 2, 1, 3, 4, 0],
        [4, 4, 4, 5, 6, 0],
      ],
      [
        [5, 2, 2, 0, 5, 7],
        [0, 2, 3, 0, 3, 5],
      ],
      [
        [2, 0, 5, 4, 7, 3],
        [3, 2, 5, 6, 2, 4],
      ],
      [
        [1, 2, 7, 3, 7, 7],
        [4, 0, 0, 3, 4, 0],
      ],
      [
        [5, 2, 7, 2, 2, 4],
        [7, 7, 6, 4, 6, 1],
      ],
      [
        [5, 6, 3, 6, 1, 6],
        [1, 0, 4, 6, 1, 2],
      ],
      [
        [4, 6, 4, 2, 1, 4],
        [2, 1, 2, 7, 5, 1],
      ],
      [
        [7, 7, 0, 4, 7, 1],
        [5, 2, 5, 0, 2, 5],
      ],
      [
        [2, 2, 0, 5, 3, 7],
        [7, 1, 6, 3, 6, 4],
      ],
      [
        [3, 2, 5, 3, 3, 6],
        [3, 0, 5, 5, 4, 1],
      ],
      [
        [2, 0, 1, 3, 4, 3],
        [6, 2, 5, 0, 2, 0],
      ],
      [
        [4, 3, 0, 1, 1, 1],
        [6, 4, 3, 2, 2, 5],
      ],
      [
        [5, 5, 5, 0, 1, 5],
        [3, 6, 4, 0, 0, 1],
      ],
      [
        [5, 7, 5, 5, 7, 7],
        [4, 7, 3, 4, 3, 2],
      ],
      [
        [0, 5, 5, 3, 4, 6],
        [6, 1, 4, 7, 3, 0],
      ],
      [
        [2, 7, 7, 1, 7, 1],
        [0, 7, 5, 3, 2, 2],
      ],
      [
        [6, 3, 0, 4, 7, 7],
        [1, 0, 5, 6, 5, 2],
      ],
      [
        [5, 1, 7, 5, 2, 0],
        [3, 1, 0, 6, 4, 2],
      ],
      [
        [3, 1, 6, 5, 3, 3],
        [6, 7, 5, 2, 2, 7],
      ],
      [
        [3, 6, 4, 4, 7, 3],
        [1, 1, 0, 2, 2, 5],
      ],
      [
        [6, 5, 5, 3, 5, 7],
        [5, 7, 1, 7, 0, 5],
      ],
      [
        [6, 3, 2, 3, 4, 1],
        [5, 5, 0, 3, 6, 6],
      ],
      [
        [1, 6, 0, 5, 6, 2],
        [0, 2, 3, 7, 2, 3],
      ],
      [
        [6, 1, 4, 3, 7, 7],
        [6, 3, 7, 3, 4, 2],
      ],
      [
        [0, 5, 1, 3, 4, 5],
        [1, 3, 4, 3, 6, 7],
      ],
      [
        [0, 0, 4, 5, 3, 4],
        [6, 3, 5, 2, 6, 0],
      ],
      [
        [0, 7, 4, 3, 0, 7],
        [4, 7, 1, 7, 6, 0],
      ],
      [
        [5, 7, 2, 6, 1, 2],
        [2, 2, 6, 6, 6, 2],
      ],
      [
        [3, 2, 7, 1, 0, 4],
        [4, 3, 3, 6, 4, 7],
      ],
      [
        [2, 1, 5, 0, 3, 2],
        [4, 3, 1, 5, 1, 7],
      ],
      [
        [2, 3, 7, 0, 3, 1],
        [4, 0, 7, 6, 5, 7],
      ],
      [
        [6, 0, 3, 6, 1, 7],
        [7, 4, 2, 2, 0, 3],
      ],
      [
        [3, 5, 1, 0, 0, 5],
        [2, 6, 4, 3, 6, 2],
      ],
      [
        [1, 5, 1, 1, 4, 6],
        [4, 3, 4, 5, 0, 5],
      ],
      [
        [6, 3, 5, 5, 4, 7],
        [7, 7, 5, 4, 1, 5],
      ],
      [
        [1, 1, 6, 0, 1, 4],
        [1, 7, 3, 5, 1, 4],
      ],
      [
        [1, 7, 0, 0, 7, 6],
        [2, 1, 4, 5, 2, 0],
      ],
      [
        [0, 0, 2, 3, 0, 2],
        [5, 2, 4, 3, 4, 3],
      ],
      [
        [5, 0, 4, 5, 1, 2],
        [5, 7, 5, 6, 4, 1],
      ],
    ];

    var arrays2 = [
      [
        [6, 7, 2, 6, 3, 4],
        [7, 4, 4, 6, 3, 0],
      ],
      [
        [5, 0, 2, 0, 1, 4],
        [6, 7, 6, 7, 6, 6],
      ],
      [
        [0, 6, 1, 6, 0, 6],
        [0, 3, 1, 7, 0, 2],
      ],
      [
        [0, 7, 6, 5, 1, 7],
        [1, 7, 0, 3, 5, 1],
      ],
      [
        [3, 6, 2, 1, 7, 7],
        [1, 3, 2, 0, 0, 2],
      ],
      [
        [0, 7, 1, 2, 2, 2],
        [6, 0, 7, 6, 6, 6],
      ],
      [
        [3, 0, 7, 0, 7, 0],
        [0, 0, 2, 5, 1, 0],
      ],
      [
        [7, 4, 2, 7, 2, 7],
        [2, 3, 2, 4, 6, 1],
      ],
      [
        [5, 2, 5, 7, 6, 7],
        [2, 6, 2, 1, 6, 2],
      ],
      [
        [0, 0, 5, 1, 6, 0],
        [3, 6, 3, 1, 0, 0],
      ],
      [
        [5, 0, 7, 7, 2, 0],
        [0, 7, 5, 2, 7, 6],
      ],
      [
        [6, 3, 4, 7, 4, 1],
        [1, 3, 6, 0, 5, 0],
      ],
      [
        [2, 3, 6, 1, 2, 2],
        [7, 4, 3, 4, 6, 1],
      ],
      [
        [7, 0, 4, 0, 6, 0],
        [3, 7, 4, 7, 0, 4],
      ],
      [
        [0, 1, 3, 6, 6, 2],
        [6, 7, 4, 0, 6, 1],
      ],
      [
        [5, 2, 0, 1, 5, 7],
        [1, 1, 7, 6, 6, 3],
      ],
      [
        [1, 6, 7, 5, 3, 3],
        [2, 0, 6, 7, 3, 6],
      ],
      [
        [3, 5, 0, 5, 4, 7],
        [2, 1, 5, 1, 7, 3],
      ],
      [
        [3, 0, 0, 6, 3, 1],
        [1, 0, 7, 3, 4, 3],
      ],
      [
        [6, 6, 1, 1, 3, 0],
        [2, 1, 7, 6, 6, 6],
      ],
      [
        [0, 1, 5, 1, 1, 1],
        [1, 0, 0, 1, 3, 1],
      ],
      [
        [1, 2, 1, 4, 0, 0],
        [3, 0, 1, 6, 6, 6],
      ],
      [
        [0, 4, 1, 3, 3, 0],
        [1, 5, 4, 5, 3, 6],
      ],
      [
        [2, 1, 3, 3, 7, 2],
        [7, 0, 5, 3, 2, 1],
      ],
      [
        [1, 1, 5, 7, 1, 6],
        [7, 1, 7, 5, 4, 6],
      ],
      [
        [3, 0, 0, 6, 3, 5],
        [0, 0, 6, 2, 4, 0],
      ],
      [
        [2, 1, 6, 1, 5, 7],
        [0, 5, 0, 6, 2, 6],
      ],
      [
        [7, 0, 5, 5, 1, 7],
        [6, 2, 5, 4, 5, 7],
      ],
      [
        [5, 5, 2, 1, 1, 5],
        [6, 1, 7, 1, 4, 3],
      ],
      [
        [7, 7, 1, 3, 6, 6],
        [4, 1, 6, 3, 1, 2],
      ],
      [
        [4, 4, 2, 6, 3, 3],
        [1, 2, 2, 2, 6, 3],
      ],
      [
        [2, 7, 7, 6, 5, 4],
        [6, 6, 3, 7, 1, 7],
      ],
      [
        [0, 2, 3, 7, 1, 2],
        [4, 2, 4, 0, 6, 7],
      ],
      [
        [4, 2, 1, 0, 6, 5],
        [3, 7, 3, 3, 5, 3],
      ],
      [
        [6, 1, 2, 7, 3, 4],
        [6, 2, 2, 4, 1, 3],
      ],
      [
        [2, 3, 6, 7, 2, 1],
        [7, 7, 2, 1, 7, 2],
      ],
      [
        [4, 0, 5, 0, 7, 0],
        [1, 4, 5, 4, 3, 3],
      ],
      [
        [2, 5, 3, 1, 6, 6],
        [0, 1, 0, 5, 2, 1],
      ],
      [
        [0, 1, 3, 1, 3, 0],
        [3, 7, 2, 2, 1, 2],
      ],
      [
        [2, 0, 1, 5, 5, 0],
        [4, 2, 1, 4, 5, 2],
      ],
      [
        [3, 0, 2, 5, 1, 2],
        [3, 1, 2, 6, 3, 0],
      ],
      [
        [2, 2, 5, 2, 2, 4],
        [5, 3, 3, 7, 3, 7],
      ],
      [
        [5, 0, 3, 6, 6, 4],
        [2, 5, 6, 1, 3, 3],
      ],
      [
        [0, 3, 5, 0, 7, 5],
        [6, 0, 2, 1, 2, 0],
      ],
      [
        [7, 1, 5, 1, 7, 2],
        [4, 7, 5, 2, 6, 0],
      ],
      [
        [0, 7, 4, 6, 4, 2],
        [5, 0, 0, 7, 2, 1],
      ],
      [
        [1, 6, 0, 6, 1, 7],
        [0, 7, 5, 1, 6, 1],
      ],
      [
        [0, 1, 1, 4, 4, 3],
        [5, 6, 1, 2, 5, 4],
      ],
      [
        [1, 5, 3, 1, 0, 2],
        [1, 5, 1, 0, 7, 0],
      ],
      [
        [2, 0, 0, 0, 2, 0],
        [0, 0, 4, 7, 5, 6],
      ],
      [
        [6, 1, 6, 0, 4, 7],
        [5, 4, 7, 7, 2, 3],
      ],
      [
        [6, 5, 7, 4, 2, 3],
        [7, 3, 5, 7, 0, 3],
      ],
      [
        [6, 6, 2, 7, 0, 7],
        [2, 4, 4, 7, 7, 0],
      ],
      [
        [6, 6, 2, 4, 5, 4],
        [3, 3, 1, 4, 5, 7],
      ],
      [
        [0, 3, 6, 0, 7, 3],
        [4, 7, 3, 4, 7, 0],
      ],
      [
        [4, 1, 1, 7, 2, 7],
        [5, 4, 0, 2, 1, 0],
      ],
      [
        [0, 4, 6, 1, 1, 7],
        [3, 1, 7, 1, 2, 1],
      ],
      [
        [4, 0, 7, 7, 3, 1],
        [2, 7, 4, 6, 6, 6],
      ],
      [
        [7, 5, 1, 5, 5, 5],
        [3, 1, 0, 5, 4, 5],
      ],
      [
        [1, 4, 1, 2, 5, 2],
        [7, 3, 3, 7, 5, 3],
      ],
      [
        [4, 4, 1, 2, 7, 1],
        [1, 7, 7, 2, 3, 4],
      ],
      [
        [2, 2, 5, 6, 4, 1],
        [7, 2, 6, 4, 0, 5],
      ],
      [
        [5, 3, 6, 3, 2, 6],
        [0, 7, 4, 5, 1, 0],
      ],
      [
        [3, 3, 1, 1, 6, 7],
        [7, 0, 3, 4, 6, 4],
      ],
      [
        [2, 3, 4, 1, 6, 5],
        [0, 0, 3, 7, 3, 4],
      ],
      [
        [2, 3, 0, 1, 7, 7],
        [7, 6, 0, 6, 4, 2],
      ],
      [
        [3, 0, 5, 7, 5, 6],
        [0, 1, 3, 3, 1, 4],
      ],
      [
        [2, 1, 6, 2, 2, 6],
        [7, 3, 7, 1, 6, 5],
      ],
      [
        [1, 2, 2, 3, 7, 4],
        [5, 3, 1, 2, 0, 5],
      ],
      [
        [4, 0, 0, 2, 2, 0],
        [0, 5, 5, 5, 4, 6],
      ],
      [
        [5, 6, 3, 0, 2, 7],
        [3, 0, 5, 6, 6, 3],
      ],
      [
        [2, 3, 3, 5, 2, 7],
        [4, 5, 1, 7, 4, 5],
      ],
      [
        [0, 1, 0, 5, 7, 7],
        [1, 7, 3, 2, 4, 3],
      ],
      [
        [4, 2, 4, 6, 0, 1],
        [6, 0, 4, 5, 6, 7],
      ],
      [
        [1, 0, 2, 2, 5, 6],
        [4, 7, 7, 5, 1, 2],
      ],
      [
        [5, 5, 3, 2, 4, 0],
        [3, 2, 1, 6, 5, 1],
      ],
      [
        [0, 2, 5, 3, 0, 1],
        [3, 1, 3, 6, 3, 5],
      ],
      [
        [2, 5, 5, 7, 5, 0],
        [2, 5, 2, 1, 2, 7],
      ],
      [
        [6, 0, 3, 4, 1, 5],
        [6, 6, 6, 0, 5, 1],
      ],
      [
        [6, 7, 5, 3, 3, 0],
        [0, 6, 3, 2, 4, 1],
      ],
      [
        [1, 0, 4, 7, 7, 7],
        [2, 3, 6, 4, 7, 2],
      ],
      [
        [5, 2, 1, 4, 3, 3],
        [0, 0, 5, 4, 1, 3],
      ],
      [
        [0, 0, 4, 2, 3, 4],
        [6, 4, 0, 5, 3, 1],
      ],
      [
        [4, 0, 2, 6, 3, 2],
        [3, 6, 2, 0, 0, 1],
      ],
      [
        [3, 6, 7, 3, 1, 5],
        [3, 4, 2, 5, 2, 5],
      ],
      [
        [1, 6, 0, 7, 7, 4],
        [5, 2, 4, 1, 3, 1],
      ],
      [
        [7, 3, 0, 2, 3, 2],
        [4, 7, 0, 1, 0, 1],
      ],
      [
        [6, 1, 6, 5, 5, 5],
        [4, 7, 5, 7, 1, 1],
      ],
      [
        [1, 2, 7, 5, 7, 3],
        [7, 1, 0, 7, 7, 6],
      ],
      [
        [3, 0, 3, 4, 4, 2],
        [2, 4, 7, 7, 7, 6],
      ],
      [
        [6, 3, 6, 7, 2, 1],
        [5, 2, 2, 2, 0, 3],
      ],
      [
        [5, 4, 3, 0, 6, 5],
        [2, 7, 3, 5, 5, 6],
      ],
      [
        [2, 6, 7, 7, 4, 0],
        [2, 5, 3, 5, 2, 6],
      ],
      [
        [7, 2, 4, 2, 7, 7],
        [7, 2, 4, 1, 4, 0],
      ],
      [
        [7, 2, 4, 7, 5, 5],
        [2, 6, 4, 7, 2, 2],
      ],
      [
        [2, 0, 7, 0, 2, 1],
        [1, 3, 2, 1, 3, 4],
      ],
      [
        [4, 3, 3, 2, 4, 7],
        [0, 1, 5, 1, 7, 1],
      ],
      [
        [5, 7, 0, 6, 1, 4],
        [5, 2, 3, 2, 2, 0],
      ],
      [
        [1, 7, 7, 1, 6, 3],
        [0, 2, 7, 3, 0, 0],
      ],
      [
        [3, 1, 0, 1, 7, 1],
        [4, 0, 6, 7, 0, 2],
      ],
      [
        [6, 1, 7, 7, 6, 2],
        [7, 2, 7, 6, 3, 0],
      ],
      [
        [5, 3, 7, 2, 3, 5],
        [3, 1, 0, 7, 0, 3],
      ],
      [
        [0, 3, 7, 5, 2, 5],
        [7, 4, 0, 0, 4, 3],
      ],
      [
        [5, 2, 6, 5, 2, 4],
        [7, 4, 1, 1, 0, 2],
      ],
      [
        [6, 2, 0, 4, 6, 6],
        [0, 4, 6, 2, 1, 5],
      ],
      [
        [0, 3, 3, 4, 7, 4],
        [4, 5, 7, 1, 3, 5],
      ],
      [
        [2, 7, 2, 2, 6, 2],
        [5, 0, 6, 0, 4, 5],
      ],
      [
        [5, 6, 4, 3, 2, 6],
        [7, 1, 4, 0, 2, 6],
      ],
      [
        [2, 0, 5, 0, 5, 2],
        [7, 0, 5, 3, 0, 5],
      ],
      [
        [0, 7, 5, 2, 4, 1],
        [6, 4, 5, 3, 5, 0],
      ],
      [
        [2, 3, 2, 2, 6, 0],
        [0, 4, 5, 7, 3, 4],
      ],
      [
        [5, 6, 2, 2, 0, 1],
        [1, 0, 2, 0, 2, 4],
      ],
      [
        [3, 3, 6, 3, 2, 2],
        [4, 7, 4, 0, 5, 2],
      ],
      [
        [3, 7, 5, 0, 7, 4],
        [1, 7, 0, 7, 2, 6],
      ],
      [
        [3, 5, 6, 2, 7, 2],
        [3, 2, 2, 1, 3, 7],
      ],
      [
        [6, 0, 7, 0, 5, 3],
        [1, 2, 4, 7, 1, 7],
      ],
      [
        [7, 1, 4, 5, 2, 7],
        [0, 7, 7, 6, 0, 6],
      ],
      [
        [1, 3, 6, 7, 7, 2],
        [4, 1, 7, 0, 4, 5],
      ],
      [
        [2, 3, 6, 4, 1, 3],
        [7, 1, 0, 4, 5, 3],
      ],
      [
        [6, 2, 1, 7, 7, 0],
        [6, 1, 6, 4, 6, 3],
      ],
      [
        [5, 6, 4, 5, 3, 0],
        [5, 7, 2, 5, 6, 2],
      ],
      [
        [4, 1, 4, 0, 6, 3],
        [1, 0, 4, 3, 5, 6],
      ],
      [
        [1, 7, 7, 0, 4, 3],
        [2, 7, 3, 0, 2, 1],
      ],
      [
        [2, 3, 2, 1, 6, 7],
        [3, 2, 0, 3, 6, 7],
      ],
      [
        [3, 5, 4, 6, 4, 5],
        [1, 3, 6, 7, 2, 3],
      ],
      [
        [2, 2, 1, 1, 7, 5],
        [1, 7, 4, 6, 6, 5],
      ],
      [
        [4, 4, 1, 0, 5, 0],
        [3, 4, 0, 7, 2, 3],
      ],
      [
        [0, 0, 3, 7, 4, 1],
        [1, 6, 7, 5, 2, 5],
      ],
      [
        [2, 4, 0, 5, 5, 1],
        [0, 3, 1, 7, 3, 4],
      ],
      [
        [1, 1, 0, 3, 7, 4],
        [0, 4, 0, 6, 1, 0],
      ],
      [
        [4, 4, 7, 2, 6, 7],
        [2, 7, 2, 0, 0, 7],
      ],
      [
        [2, 5, 0, 1, 2, 3],
        [6, 6, 1, 3, 4, 1],
      ],
      [
        [4, 7, 2, 5, 0, 1],
        [1, 5, 2, 4, 3, 1],
      ],
      [
        [4, 0, 2, 0, 1, 2],
        [7, 2, 5, 3, 2, 3],
      ],
      [
        [4, 4, 3, 7, 1, 1],
        [7, 5, 3, 4, 0, 1],
      ],
      [
        [0, 1, 6, 7, 5, 3],
        [0, 5, 7, 2, 2, 4],
      ],
      [
        [0, 0, 2, 0, 1, 6],
        [3, 1, 7, 0, 0, 5],
      ],
      [
        [0, 7, 0, 1, 6, 3],
        [5, 3, 1, 1, 1, 3],
      ],
      [
        [5, 0, 3, 1, 5, 7],
        [2, 2, 7, 2, 1, 6],
      ],
      [
        [3, 5, 0, 0, 5, 3],
        [3, 7, 2, 2, 3, 7],
      ],
      [
        [5, 1, 7, 2, 5, 0],
        [3, 6, 1, 7, 5, 4],
      ],
      [
        [7, 0, 6, 7, 2, 1],
        [3, 4, 6, 6, 3, 7],
      ],
      [
        [1, 4, 7, 6, 1, 4],
        [7, 3, 7, 3, 2, 2],
      ],
      [
        [4, 0, 6, 0, 6, 0],
        [5, 1, 7, 7, 7, 2],
      ],
      [
        [3, 3, 7, 3, 4, 3],
        [7, 6, 1, 6, 2, 0],
      ],
      [
        [5, 2, 5, 4, 4, 3],
        [3, 1, 6, 2, 6, 1],
      ],
      [
        [4, 0, 6, 1, 4, 4],
        [6, 0, 4, 1, 0, 1],
      ],
      [
        [7, 7, 5, 1, 4, 3],
        [6, 4, 4, 1, 5, 1],
      ],
      [
        [4, 1, 2, 7, 1, 6],
        [1, 5, 3, 0, 6, 0],
      ],
      [
        [7, 5, 2, 4, 2, 3],
        [6, 3, 2, 5, 2, 7],
      ],
    ];
    // var arrays = [
    //   [
    //     [1, 2, 3, 4, 5, 6],
    //     [7, 2, 3, 5, 4, 1],
    //   ],
    //   [
    //     [1, 6, 5, 0, 2, 3],
    //     [2, 3, 1, 5, 3, 2],
    //   ],
    // ];

    var arrays;

    if (Math.random() > 0.5) {
      arrays = arrays1;
    } else {
      arrays = arrays2;
    }

    function shuffle(arr) {
      var currentIndex = arr.length,
        randomIndex;
      while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;

        [arr[currentIndex], arr[randomIndex]] = [
          arr[randomIndex],
          arr[currentIndex],
        ];
      }

      return arr;
    }

    function swap(arrays) {
      for (var i = 0; i < arrays.length; i++) {
        if (Math.random() > 0.5) {
          var tmp = arrays[i][1];
          arrays[i][1] = arrays[i][0];
          arrays[i][0] = tmp;
        }
      }
    }

    shuffle(arrays); //shuffle order of trials
    swap(arrays); //shuffle L or R

    var indexx = 0;
    var indexx2 = 0;

    function rnd_array(arrays) {
      var idx_array = arrays[indexx][0];
      indexx++;
      return idx_array;
    }

    function rnd_array2(arrays) {
      var idx_array = arrays[indexx2][1];
      indexx2++;
      return idx_array;
    }
    var empt = [];

    function drawRectLexp(c) {
      j = 0;
      var arr_left = rnd_array(arrays);
      arr_left = shuffle(arr_left);
      empt[indexx] = arr_left;
      var ctx = c.getContext("2d");
      ctx.beginPath();

      ctx.fillStyle = col1[arr_left[0]];
      ctx.fillRect(0, 0, 100, 100);

      ctx.fillStyle = col1[arr_left[1]];
      ctx.fillRect(125, 0, 100, 100);

      ctx.fillStyle = col1[arr_left[2]];
      ctx.fillRect(250, 0, 100, 100);

      ctx.fillStyle = col1[arr_left[3]];
      ctx.fillRect(0, 125, 100, 100);

      ctx.fillStyle = col1[arr_left[4]];
      ctx.fillRect(125, 125, 100, 100);

      ctx.fillStyle = col1[arr_left[5]];
      ctx.fillRect(250, 125, 100, 100);

      for (var i = 0; i < 6; ++i) {
        j += arr_left[i] + 1;
      }
      arr_L = [
        arr_left[0] + 1,
        arr_left[1] + 1,
        arr_left[2] + 1,
        arr_left[3] + 1,
        arr_left[4] + 1,
        arr_left[5] + 1,
      ];
    }

    function drawRectRexp(d) {
      w = 0;

      var arr_right = rnd_array2(arrays);
      arr_right = shuffle(arr_right);
      empt[indexx2] = arr_right;

      var ctx = d.getContext("2d");
      ctx.beginPath();

      ctx.fillStyle = col1[arr_right[0]];
      ctx.fillRect(0, 0, 100, 100);

      ctx.fillStyle = col1[arr_right[1]];
      ctx.fillRect(125, 0, 100, 100);

      ctx.fillStyle = col1[arr_right[2]];
      ctx.fillRect(250, 0, 100, 100);

      ctx.fillStyle = col1[arr_right[3]];
      ctx.fillRect(0, 125, 100, 100);

      ctx.fillStyle = col1[arr_right[4]];
      ctx.fillRect(125, 125, 100, 100);

      ctx.fillStyle = col1[arr_right[5]];
      ctx.fillRect(250, 125, 100, 100);

      for (var z = 0; z < arr_right.length; ++z) {
        w += arr_right[z] + 1;
        // arr_right[z] = arr_right[z]+1
      }
      arr_R = [
        arr_right[0] + 1,
        arr_right[1] + 1,
        arr_right[2] + 1,
        arr_right[3] + 1,
        arr_right[4] + 1,
        arr_right[5] + 1,
      ];
      // console.log("arr_R :" + w)
    }

    var j = 0;
    var w = 0;
    var trial_count = 1;

    var arr_L;
    var arr_R;

    function rainbow(z) {
      var test = 0;

      var ctx = z.getContext("2d");
      ctx.beginPath();

      ctx.fillStyle = col1[0];
      ctx.fillRect(125, 0, 100, 100);

      ctx.fillStyle = col1[1];
      ctx.fillRect(250, 0, 100, 100);

      ctx.fillStyle = col1[2];
      ctx.fillRect(375, 0, 100, 100);

      ctx.fillStyle = col1[3];
      ctx.fillRect(500, 0, 100, 100);

      ctx.fillStyle = col1[4];
      ctx.fillRect(625, 0, 100, 100);

      ctx.fillStyle = col1[5];
      ctx.fillRect(750, 0, 100, 100);

      ctx.fillStyle = col1[6];
      ctx.fillRect(875, 0, 100, 100);

      ctx.fillStyle = col1[7];
      ctx.fillRect(1000, 0, 100, 100);

      // ctx.fillStyle = colors[8];
      // ctx.fillRect(1000, 0, 100, 100);

      // ctx.fillStyle = colors[9];
      // ctx.fillRect(1125, 0, 100, 100);

      // console.log("RAINBOW")
    }

    function rainbow_values(rv) {
      var ctx = rv.getContext("2d");
      ctx.font = "36px Times New Roman, sans-serif";
      ctx.fillStyle = "white";
      var n = 290 - 165;

      //ctx.fillText("1", 40, 50);
      ctx.fillText("1", 165, 50);
      ctx.fillText("2", 290, 50);
      ctx.fillText("3", 290 + n, 50);
      ctx.fillText("4", 290 + 2 * n, 50);
      ctx.fillText("5", 290 + 3 * n, 50);
      ctx.fillText("6", 290 + 4 * n, 50);
      ctx.fillText("7", 290 + 5 * n, 50);
      ctx.fillText("8", 290 + 6 * n, 50);
      // ctx.fillText("10", 290 + 7*n - 20, 50);
    }

    function rainbow_text(rv) {
      var ctx = rv.getContext("2d");
      ctx.font = "24px Times New Roman, sans-serif";
      ctx.fillStyle = "white";
      // ctx.textAlign = 'center';
      //ctx.fillText("Colors farther to the right are worth more points.", 140, 50);
      ctx.fillText("Press the SPACE BAR to continue.", 450, 50);
    }

    function drawRectL(c, arr_left) {
      j = 0;

      var ctx = c.getContext("2d");
      ctx.beginPath();

      // var g = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[g];
      ctx.fillStyle = col1[arr_left[0]];
      ctx.fillRect(0, 0, 100, 100);

      // var h = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[h];
      ctx.fillStyle = col1[arr_left[1]];
      ctx.fillRect(125, 0, 100, 100);

      // var i = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[i];
      ctx.fillStyle = col1[arr_left[2]];
      ctx.fillRect(250, 0, 100, 100);

      // var j = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[j];
      ctx.fillStyle = col1[arr_left[3]];
      ctx.fillRect(0, 125, 100, 100);

      // var k = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[k];
      ctx.fillStyle = col1[arr_left[4]];
      ctx.fillRect(125, 125, 100, 100);

      // var l = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[l];
      ctx.fillStyle = col1[arr_left[5]];
      ctx.fillRect(250, 125, 100, 100);

      // arr_L = [a, b, c, d, e, f]
      for (var i = 0; i < arr_left.length; ++i) {
        j += arr_left[i] + 1;
      }
      arr_L = [
        arr_left[0] + 1,
        arr_left[1] + 1,
        arr_left[2] + 1,
        arr_left[3] + 1,
        arr_left[4] + 1,
        arr_left[5] + 1,
      ];
      console.log(j);
    }

    function drawtext_l_incentive(l) {
      var ctx = l.getContext("2d");
      var text = j;
      ctx.font = "36px Times New Roman, sans-serif";
      ctx.textAlign = "center";
      ctx.fillStyle = "white";
      ctx.fillText("   " + j, 140, 100);
    }
    function drawtext_r_incentive(r) {
      var ctx = r.getContext("2d");
      ctx.font = "36px Times New Roman, sans-serif";
      ctx.textAlign = "center";
      ctx.fillStyle = "white";
      ctx.fillText("   " + w, 140, 100);
    }
    var fixedvalleft = 0;

    function drawRectR(d, arr_right) {
      w = 0;

      var ctx = d.getContext("2d");
      ctx.beginPath();

      // var g = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[g];
      ctx.fillStyle = col1[arr_right[0]];
      ctx.fillRect(0, 0, 100, 100);

      // var h = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[h];
      ctx.fillStyle = col1[arr_right[1]];
      ctx.fillRect(125, 0, 100, 100);

      // var i = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[i];
      ctx.fillStyle = col1[arr_right[2]];
      ctx.fillRect(250, 0, 100, 100);

      // var j = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[j];
      ctx.fillStyle = col1[arr_right[3]];
      ctx.fillRect(0, 125, 100, 100);

      // var k = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[k];
      ctx.fillStyle = col1[arr_right[4]];
      ctx.fillRect(125, 125, 100, 100);

      // var l = Math.floor(Math.random()*8);
      // ctx.fillStyle = col1[l];
      ctx.fillStyle = col1[arr_right[5]];
      ctx.fillRect(250, 125, 100, 100);

      for (var z = 0; z < arr_right.length; ++z) {
        w += arr_right[z] + 1;
        // arr_right[z] = arr_right[z]+1
      }
      arr_R = [
        arr_right[0] + 1,
        arr_right[1] + 1,
        arr_right[2] + 1,
        arr_right[3] + 1,
        arr_right[4] + 1,
        arr_right[5] + 1,
      ];
      // console.log("arr_R :" + w)
    }

    function coverWhite(wh) {
      var ctx = wh.getContext("2d");
      ctx.beginPath();
      var a = Math.floor(Math.random() * 8);
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, 200, 200);
    }

    var instr1 = {
      type: "html-keyboard-response",
      stimulus: `<p>Welcome to the study! </p>
            <p>Today, you will make some decisions about colorful objects.</p>
            <p>If you are ready to begin, please press the SPACE BAR.</p>`, //numerosity uses Space but Blair matlab code uses up arrow, which one
      choices: ["space"],
    };

    var instr2 = {
      type: "html-keyboard-response",
      stimulus: `<p>Today, your task will be to choose between two objects. </p>
            <p>To see an example, press the SPACE BAR. </p>`,
      choices: ["space"],
    };

    var instr3 = {
      type: "image-keyboard-response",
      stimulus: ["img/exampleobj.png"],
      stimulus_height: 300,
      stimulus_width: 450,
      prompt: "<p>Press the SPACE BAR to continue</p>",
      choices: ["space"],
    };

    var instr4 = {
      type: "html-keyboard-response",
      stimulus:
        `<p>Over ` +
        rep +
        ` rounds, you will be choosing the better of two objects. The value of each</p>
            <p>object is simply the sum of the values of the colored blocks in the object.</p>
            <p>Each block is valued according to its color, and each color is worth a different</p>
            <p>amount of points. Also, each color is equally likely to appear. In order to know</p>
            <p> the value of an object, you will need to learn what each color is worth.</p>
            <p>Press the SPACE BAR to continue. </p>`,
      choices: ["space"],
    };

    var instr5 = {
      type: "html-keyboard-response",
      stimulus: `<p>Each round, you will see two objects on the screen. Your task is to indicate which</p>
            <p> of the two objects you want to choose. All objects will have positive values and you will gain</p>
            <p>points based on your choices. In <b>accuracy-based rounds</b>, you will gain a bonus for choosing the better</p>
            <p>of the two options. In <b>value-based rounds</b>, you will simply gain the value of the object you selected.</p>
            <p>We will always let you know which type of round you are in before you make any chocies.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instr6 = {
      type: "html-keyboard-response",
      stimulus:
        `<p>At the end of the task, you will gain a reward based on your performance in one of the two types</p>
            <p>of rounds. You will have an equal chance of being rewarded based on the <b>accuracy-based rounds</b></p>
            <p>or the <b>value-based rounds</b>. If an <b>accuracy-based round</b> is selected for pay out, you will</p>
            <p>gain ` +
        acc_reward +
        ` points if you selected the better option in that round, but 0 points if you selected </p>
            <p>the worse option. If a <b>value-based round</b> is selected, you will gain the point value of the option</p>
            <p>you selected, regardless of whether it is the better or worse option.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instr7 = {
      type: "html-keyboard-response",
      stimulus: `<p>The following screen will display the colors you will see in the first</p>
            <p>few rounds. The values of the colors <b>increase</b> from left to right.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instr7v2 = {
      type: "html-keyboard-response",
      stimulus: `<p>The following screen will display the new colors you will use in the second</p>
            <p>half of this experiment. As before, the values of the colors <b>increase</b> from left to right.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var show_rainbow = {
      type: "rainbow",
      rainbow_parameter: rainbow,
      rainbow_values_parameter: rainbow_values,
      text_parameter: rainbow_text,
      choices: ["space"],
    };

    var instrfixed = {
      type: "html-keyboard-response",
      stimulus:
        `<p>In the following rounds, you will receive an <b>accuracy-based reward</b> for choosing the better option. </p>
            <p>You will receive ` +
        acc_reward +
        ` points for selecting the better option, and zero points for selecting the worse option.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instrincentive = {
      type: "html-keyboard-response",
      stimulus: `<p>In the following rounds, you will receive a <b>value-based reward</b> for your choices.</p>
        <p>You will receive the point value of the option you select, regardless of whether or not it is the better option.</p>
        <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instr_start_training = {
      type: "html-keyboard-response",
      stimulus: `<p>You will now begin the training. </p>
            <p>Six random colors will appear on the left, and six random colors will appear on the right.</p>
            <p>Press <b>F</b> to select left, and press <b>J</b> to select right.</p>
            <p>When you are ready, rest your fingers on <b>F</b> and <b>J</b>.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var instr_start_training_2 = {
      type: "html-keyboard-response",
      stimulus: `<p>You will now begin the training. </p>
            <p>When you are ready, rest your fingers on <b>F</b> and <b>J</b>.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var pass_training_FR = {
      type: "html-keyboard-response",
      stimulus:
        `<p>You are now ready to begin the experiment. Remember, if this section is chosen</p>
        <p>for payout, one random trial will be selected and you will receive ` +
        acc_reward +
        ` points for choosing the better option.</p>
        <p>When you are ready, rest your fingers on <b>F</b> and <b>J</b>.</p>
        <p>Press the SPACE BAR to start the experiment.</p>`,
      choices: ["space"],
    };

    var pass_training_VB = {
      type: "html-keyboard-response",
      stimulus: `<p>You are now ready to begin the experiment. Remember, if this section is chosen</p>
          <p>for payout, one random trial will be selected and you will receive the point value of the chosen option.</p>
          <p>When you are ready, rest your fingers on <b>F</b> and <b>J</b>.</p>
          <p>Press the SPACE BAR to start the experiment.</p>`,
      choices: ["space"],
    };

    var fail_training_1 = {
      type: "html-keyboard-response",
      stimulus: `<p> You failed the training. </p>
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right</p>
        <p>When you are ready, press the SPACE BAR to try the training again.</p>
        `,
      choices: ["space"],
    };

    var fail_training_2 = {
      type: "html-keyboard-response",
      stimulus: `<p> You failed the training. </p>
        <p>Please remember to select the object with the higher value sum.</p>
        <p>Press <b>F</b> to select left, and press <b>J</b> to select right</p>
        <p>When you are ready, press the SPACE BAR to try the training one more time.</p>
        `,
      choices: ["space"],
    };

    var fail_training_3 = {
      type: "html-keyboard-response",
      stimulus: `<p> You failed the training a third try. Please do as best as you can in the experiment.</p>
        <p></p>
        <p>Please press space to continue.</p>
        `,
      choices: ["space"],
      // on_finish: function (data) {
      //   jsPsych.endExperiment("The experiment was ended after three failures.");
      // },
    };

    var acc_VB = [];
    var acc2_VB = [];
    var acc3_VB = [];

    var acc_FR = [];
    var acc2_FR = [];
    var acc3_FR = [];
    var fixed_FR = [];
    var fixed2_FR = [];
    var fixed3_FR = [];

    var idx = 0;
    var idx2 = 0;
    var idx3 = 0;

    //VB
    var trial_training = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_VB";
        if (j == w) {
          data.accuracy = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        acc_VB[idx] = data.accuracy;
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        // data.accuracy = acc_VB[idx];
        idx++;
        data.trialN = idx;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node_VB = {
      timeline: [fixation, trial_training],
      repetitions: n,
    };

    //Test 2
    var trial_training2 = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_VB";
        if (j == w) {
          data.acc2_VB = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.acc2_VB == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        // data.acc2_VB = acc2_VB;
        acc2_VB[idx2] = data.accuracy;
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idx2++;
        data.trialN = idx2;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node2 = {
      timeline: [fixation, trial_training2],
      repetitions: n,
    };

    //Test 3
    var trial_training3 = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_VB";
        if (j == w) {
          data.accuracy = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        acc3_VB[idx3] = data.accuracy;
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        // data.acc3_VB = acc3_VB;
        idx3++;
        data.trialN = idx3;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node3 = {
      timeline: [fixation, trial_training3],
      repetitions: n,
    };

    //Conditional 1
    var accuracy;
    var conditional_1_value = {
      timeline: [fail_training_1, node2],
      conditional_function: function () {
        accuracy = 0.0;
        var counter = 0;
        for (var i = 0; i < acc_VB.length; i++) {
          if (acc_VB[i] == 1) {
            counter++;
          }
        }
        accuracy = counter / acc_VB.length;
        if (accuracy < 0.7) {
          //change to .70
          return true;
        } else {
          return false;
        }
      },
    };

    //Conditional 2
    var accuracy2 = 1;
    var conditional_2_value = {
      timeline: [fail_training_2, node3],
      conditional_function: function () {
        accuracy2 = 0.0;
        var counter2 = 0;
        for (var i = 0; i < acc2_VB.length; i++) {
          if (acc2_VB[i] == 1) {
            counter2++;
          }
        }
        accuracy2 = counter2 / acc2_VB.length;
        if (accuracy2 < 0.7) {
          return true;
        } else {
          timeline.push(pass_training_VB);
          return false;
        }
      },
    };

    //Conditional 3
    var accuracy3 = 1;
    var conditional_3_value = {
      timeline: [fail_training_3],
      conditional_function: function () {
        accuracy3 = 0.0;
        var counter3 = 0;
        for (var i = 0; i < acc3_VB.length; i++) {
          if (acc3_VB[i] == 1) {
            counter3++;
          }
        }
        accuracy3 = counter3 / acc3_VB.length;
        if (accuracy3 < 0.7) {
          return true;
        } else {
          timeline.push(pass_training_VB);
          return false;
        }
      },
    };

    var reward_val_VB = 0;
    var reward_val_FR;
    var rand_reward = [];
    // var reward_val = 0;
    var left_arr = [];
    var right_arr = [];
    var all_arr = [];
    var randidx;
    acc_exp_FR = [];
    acc_exp_VB = [];
    var idx4 = 0;
    var left_value = [];
    var right_value = [];
    var valueScore;
    //Experiment
    var experiment_value = {
      type: "blocks-exp",
      stimulus_L: drawRectLexp,
      stimulus_R: drawRectRexp,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "experiment_VB";
        if (j == w) {
          if (Math.random() > 0.5) {
            data.accuracy = 1;
            left_arr[idx4] = j;
          } else {
            data.accuracy = 0;
            right_arr[idx4] = w;
          }
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
            left_arr[idx4] = j;
          } else {
            data.accuracy = 0;
            right_arr[idx4] = w;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
            right_arr[idx4] = w;
          } else {
            data.accuracy = 0;
            left_arr[idx4] = j;
          }
        }
        // acc_exp_VB[idx4] = data.correct;
        // data.experiment_VB_accuracy = acc_exp_VB[idx4];
        data.trialN = trial_count;
        left_value[idx4] = j;
        data.Left_sum = j;
        right_value[idx4] = w;
        data.Right_sum = w;
        // data.l_topleft = a
        // data.l_topmiddle = b
        // data.l_topright = c
        // data.l_bottomleft = d
        // data.l_bottommiddle = e
        // data.l_bottomright = f

        // data.r_topleft = g
        // data.r_topmiddle = h
        // data.r_topright = i
        // data.r_bottomleft = j
        // data.r_bottommiddle = k
        // data.r_bottomright = l
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idx4++;
        data.trialN = idx4;
        // trial_count++;
        left_arr.filter(Number);
        right_arr.filter(Number);
        all_arr = left_arr.concat(right_arr);
        // data.experiment_selections_VB = all_arr[idx4]
      },
    };

    var experiment_node_value = {
      timeline: [fixation, experiment_value],
      repetitions: rep,
    };

    var acc_points = 0;
    var fixed_points = 0;
    var value_points = 0;

    var ordermemtask;
    var testset;
    var testsetchoice;
    var checkOrder = function () {
      console.log("santiy, checkordercall");
      if (col1 == colors) {
        //PB
        if (pinktoblue) {
          ordermemtask = pinktoblue;
          console.log("pinktoblue");
          testset = PB;
        }
        if (bluetopink) {
          ordermemtask = bluetopink;
          console.log("bluetopink");
          testset = PB;
        }
      }
      if (col1 == colors2) {
        if (orangetogreen) {
          ordermemtask = orangetogreen;
          ("orangetogreen");
          testset = OG;
        }
        if (greentoorange) {
          ordermemtask = orangetogreen;
          ("greentoorange");
          testset = OG;
        }
      }
    };
    var checkOrdercall = {
      type: "call-function",
      func: checkOrder,
    };

    var OG = [
      "img/OG/18.jpg",
      "img/OG/20.jpg",
      "img/OG/23.jpg",
      "img/OG/28.jpg",
      "img/OG/32.jpg",
    ];

    var PB = [
      "img/PB/14.jpg",
      "img/PB/23.jpg",
      "img/PB/26.jpg",
      "img/PB/33.jpg",
      "img/PB/35.jpg",
    ];


    var finish_p1_fixed_done = {
      type: "html-keyboard-response",
      stimulus: `<p>You have completed the first half of the experiment.</p>
            <p>In these next rounds, your bonus will be <b>value-based</b>.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var finish_p1_value_done = {
      type: "html-keyboard-response",
      stimulus: `<p>You have completed the first half of the experiment.</p>
            <p>In these next rounds, your bonus will be <b>accuracy-based</b>.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    //Make the color spectrum different
    var myfunc = function () {
      if (col1 == colors) {
        col1 = colors2;
      } else {
        col1 = colors;
      }

      if (arrays == arrays1) {
        arrays = arrays2;
      } else {
        arrays = arrays1;
      }

      indexx = 0;
      indexx2 = 0;
    };
    var trialm = {
      type: "call-function",
      func: myfunc,
    };

    var idx5 = 0;

    var trial_training_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.accuracy = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        fixed_FR[idx5] = data.accuracy;
        // data.fixed_FR = fixed_FR[idx5];
        data.Left_sum = j;
        data.Right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idx5++;
        data.trialN = idx5;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node_fixed = {
      timeline: [fixation, trial_training_fixed],
      repetitions: n,
    };

    var idx6 = 0;
    //Test 2
    var trial_training2_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_2 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_2 = 1;
          } else {
            data.training_FR_accuracy_2 = 0;
          }
        }
        fixed2_FR[idx6] = data.training_FR_accuracy_2;
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        // data.fixed2_FR = fixed2_FR;
        idx6++;
        data.trialN = idx6;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node2_fixed = {
      timeline: [fixation, trial_training2_fixed],
      repetitions: n,
    };

    var idx7 = 0;

    //Test 3
    var trial_training3_fixed = {
      type: "blocks",
      stimulus_L: drawRectL,
      stimulus_R: drawRectR,
      text_l: drawtext_l_incentive,
      text_r: drawtext_r_incentive,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "training_FR";
        if (j == w) {
          data.training_FR_accuracy_3 = 1;
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.training_FR_accuracy_3 = 1;
          } else {
            data.training_FR_accuracy_3 = 0;
          }
        }
        fixed3_FR[idx7] = data.training_FR_accuracy_3;
        data.acc_FR = data.training_FR_accuracy_3[idx7];
        data.FR_left_sum = j;
        data.FR_right_sum = w;
        idx7++;
        data.trialN = idx7;
        // trial_count++;
      },
      //data: {shape: 'rectangle'}
    };
    var node3_fixed = {
      timeline: [fixation, trial_training3_fixed],
      repetitions: n,
    };
    var pass_FR;

    //Conditional 1
    var accuracy;
    var conditional_1_fixed = {
      timeline: [fail_training_1, node2_fixed],
      conditional_function: function () {
        accuracy = 0.0;
        var counter = 0;
        for (var i = 0; i < fixed_FR.length; i++) {
          if (fixed_FR[i] == 1) {
            counter++;
          }
        }
        accuracy = counter / fixed_FR.length;
        if (accuracy < 0.7) {
          //change to .70
          return true;
        } else {
          pass_FR = true;
          return false;
        }
      },
    };

    //Conditional 2
    var accuracy2 = 1;
    var conditional_2_fixed = {
      timeline: [fail_training_2, node3_fixed],
      conditional_function: function () {
        accuracy2 = 0.0;
        var counter2 = 0;
        for (var i = 0; i < fixed2_FR.length; i++) {
          if (fixed2_FR[i] == 1) {
            counter2++;
          }
        }
        accuracy2 = counter2 / fixed2_FR.length;
        if (accuracy2 < 0.7) {
          return true;
        } else {
          // console.log("test");
          pass_FR = true;
          return false;
        }
      },
    };

    //Conditional 3
    var accuracy3 = 1;
    var conditional_3_fixed = {
      timeline: [fail_training_3],
      conditional_function: function () {
        accuracy3 = 0.0;
        var counter3 = 0;
        for (var i = 0; i < fixed3_FR.length; i++) {
          if (fixed3_FR[i] == 1) {
            counter3++;
          }
        }
        accuracy3 = counter3 / fixed3_FR.length;
        if (accuracy3 < 0.7) {
          return true;
        } else {
          // console.log("test");
          pass_FR = true;
          return false;
        }
      },
    };

    //150 trials of main task

    //Make the color spectrum different
    // var myfunc2 = function () {
    //   if (pass_FR) {
    //     timeline.push(pass_training_FR);
    //   }
    // };
    // var trialm2 = {
    //   type: "call-function",
    //   func: myfunc2,
    // };

    var reward_val;
    var rand_reward = [];
    // var reward_val = 0;
    // var left_arr = [];
    // var right_arr = [];
    // var all_arr = [];
    var randidx;
    var idxt = 0;
    var left_fixed = [];
    var right_fixed = [];
    //Experiment
    var experiment_fixed = {
      type: "blocks-exp",
      stimulus_L: drawRectLexp,
      stimulus_R: drawRectRexp,
      coverWhite_f: coverWhite,
      choices: ["f", "j"],
      on_finish: function (data) {
        data.task = "experiment_FR";
        if (j == w) {
          if (Math.random() > 0.5) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (j > w) {
          //if left is greater than right
          if (data.key_press == 70) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        if (w > j) {
          if (data.key_press == 74) {
            data.accuracy = 1;
          } else {
            data.accuracy = 0;
          }
        }
        // acc_exp_FR[idx5] = data.correct;
        // data.acc_exp_FR = acc_exp_FR;
        acc_exp_FR[idxt] = data.experiment_FR_accuracy;
        data.trialN = trial_count;
        // left_arr[idx5] = j;
        left_fixed[idxt] = j;
        // data.left_FR = left_fixed //change to j for just one
        data.Left_sum = j;
        // right_arr[idx5] = w;
        right_fixed[idxt] = w;
        // data.right_FR = right_fixed //change to w for just one
        data.Right_sum = w;
        // data.l_topleft = a
        // data.l_topmiddle = b
        // data.l_topright = c
        // data.l_bottomleft = d
        // data.l_bottommiddle = e
        // data.l_bottomright = f

        // data.r_topleft = g
        // data.r_topmiddle = h
        // data.r_topright = i
        // data.r_bottomleft = j
        // data.r_bottommiddle = k
        // data.r_bottomright = l
        data.arr_L = arr_L;
        data.arr_R = arr_R;
        idxt++;
        data.trialN = idxt;
        // trial_count++;
        // all_arr = left_arr.concat(right_arr);
      },
      //data: {shape: 'rectangle'}
    };

    var experiment_node_fixed = {
      timeline: [fixation, experiment_fixed],
      repetitions: rep,
    };
    // timeline.push(experiment_node_fixed)

    //Instructions
    var instr_arr = [instr1, instr2, instr3, instr4, instr5, instr6];
    timeline = timeline.concat(instr_arr);

    var memslider_instr = {
      type: "html-keyboard-response",
      stimulus: `<p>In the following section, we will show you a few more color objects.</p>
            <p>Each of these objects come from the previous phase that you just completed.</p>
            <p>Use the slider to estimate the value of each object.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var memchoice_instr = {
      type: "html-keyboard-response",
      stimulus: `<p>In the following section, we will show you the same color objects again.</p>
            <p>We will show you two possible values of the object. Select which one you think is correct.</p>
            <p>Press the SPACE BAR to continue.</p>`,
      choices: ["space"],
    };

    var memslidertmp = {
      type: "image-slider-response",
      stimulus_height: 542 / 2,
      stimulus_width: 854 / 2,
      stimulus: function(){
        var randomstim = jsPsych.randomization.sampleWithReplacement(testset, 1)
        return randomstim;
        },
      min: 0,
      max: 50,
      slider_number: true,
      require_movement: true,
      labels: ["0", "50"],
    };

    var memslider = {
      timeline: [memslidertmp],
      repetitions: 5,
    };
    var randomstim2 = ""
    var randomstim2str = ""
    var memchoicetmp = {
      type: "image-button-response",
      stimulus_height: 542 / 2,
      stimulus_width: 854 / 2,
      stimulus: function() {
        randomstim2 = jsPsych.randomization.sampleWithReplacement(testset, 1)
        console.log(randomstim2.join())
        randomstim2str = randomstim2.join().slice(7,9)
        return randomstim2;
      },
      choices: ["Correct", "Incorrect"],
      prompt: function() {
        "The value of this object is ?"
      },
      margin_vertical: "0px",
      margin_horizontal: "50px",
    };

    var memchoice = {
      timeline: [memchoicetmp],
      repetitions: 5
    }

    if (fixedfirst == true) {
      timeline.push(instrfixed);
      timeline.push(instr7);
      timeline.push(show_rainbow);
      timeline.push(instr_start_training);
      timeline.push(node_fixed);
      timeline.push(conditional_1_fixed);
      timeline.push(conditional_2_fixed);
      timeline.push(conditional_3_fixed);
      timeline.push(pass_training_FR);
      timeline.push(experiment_node_fixed);
      timeline.push(checkOrdercall);
      timeline.push(memslider_instr);
      timeline.push(cursor_on);
      timeline.push(memslider);
      timeline.push(cursor_off);
      timeline.push(memchoice_instr);
      timeline.push(cursor_on);
      timeline.push(memchoice);
      timeline.push(cursor_off);
      timeline.push(finish_p1_fixed_done);
      timeline.push(trialm);

      timeline.push(instrincentive);
      timeline.push(instr7v2);
      timeline.push(show_rainbow);
      timeline.push(instr_start_training_2);
      timeline.push(node_VB);
      timeline.push(conditional_1_value);
      timeline.push(conditional_2_value);
      timeline.push(conditional_3_value);
      timeline.push(pass_training_VB);
      timeline.push(experiment_node_value);
      timeline.push(checkOrdercall);
      timeline.push(memslider_instr);
      timeline.push(cursor_on);
      timeline.push(memslider);
      timeline.push(cursor_off);
      timeline.push(memchoice_instr);
      timeline.push(cursor_on)
      timeline.push(memchoice);
      timeline.push(cursor_off);
    } else {
      timeline.push(instrincentive);
      timeline.push(instr7);
      timeline.push(show_rainbow);
      timeline.push(instr_start_training_2);
      timeline.push(node_VB);
      timeline.push(conditional_1_value);
      timeline.push(conditional_2_value);
      timeline.push(conditional_3_value);
      timeline.push(pass_training_VB);
      timeline.push(experiment_node_value);
      timeline.push(checkOrdercall);
      timeline.push(memslider_instr);
      timeline.push(cursor_on);
      timeline.push(memslider);
      timeline.push(cursor_off);
      timeline.push(memchoice_instr);
      timeline.push(cursor_on)
      timeline.push(memchoice);
      timeline.push(cursor_off)
      timeline.push(finish_p1_value_done);
      timeline.push(trialm);

      timeline.push(instrfixed);
      timeline.push(instr7v2);
      timeline.push(show_rainbow);
      timeline.push(instr_start_training);
      timeline.push(node_fixed);
      timeline.push(conditional_1_fixed);
      timeline.push(conditional_2_fixed);
      timeline.push(conditional_3_fixed);
      timeline.push(pass_training_FR);
      timeline.push(experiment_node_fixed);
      timeline.push(checkOrdercall);
      timeline.push(memslider_instr);
      timeline.push(cursor_on);
      timeline.push(memslider);
      timeline.push(cursor_off);
      timeline.push(memchoice_instr);
      timeline.push(cursor_on);
      timeline.push(memchoice);
      timeline.push(cursor_off);
    }
    var final_reward_value;

    var reward_is_VB;
    var reward_is_FR;
    if (Math.random() < 0.5) {
      reward_is_VB = true;
      console.log("VB reward");
    } else {
      reward_is_FR = true;
      console.log("FR reward (27 or 0");
    }

    var reward_function_VB = function () {
      while (reward_val_VB == 0 || !(reward_val_VB > 0)) {
        randidx = Math.floor(Math.random() * rep);
        reward_val_VB = all_arr[randidx];
      }
      // if(all_arr.length == 0){
      //     reward_val_VB = 0;
      // }
      console.log(reward_val_VB);
      return reward_val_VB;
    };

    var reward_node_VB = {
      type: "reward-function",
      func: reward_function_VB,
      on_finish: function (data) {
        data.randidx_VB = randidx;
        data.reward_val_VB = reward_val_VB;
        data.trialN = "NA";
      },
    };
    if (reward_is_VB) {
      timeline.push(reward_node_VB);
    }
    var randidx_FR;
    var final_reward_boolean;
    var final_reward;
    var reward_function_FR = function () {
      randidx_FR = Math.floor(Math.random() * acc_exp_FR.length);
      var final_reward_boolean = acc_exp_FR[randidx_FR];
      if (final_reward_boolean == 1) {
        // if(left_fixed[randidx] > right_fixed[randidx_FR]){
        //     final_reward_value = left_fixed[randidx_FR];
        // }else{
        //     final_reward_value = right_fixed[randidx_FR]
        final_reward_value = acc_reward;
      } else {
        final_reward_value = 0;
      }

      return final_reward_value;
    };

    var reward_node_FR = {
      type: "reward-function",
      func: reward_function_FR,
      on_finish: function (data) {
        data.randidx_FR = randidx_FR;
        data.trialN = "NA";
      },
    };
    if (reward_is_FR) {
      timeline.push(reward_node_FR);
    }

    var reward_VB = {
      type: "html-keyboard-response",
      choices: ["space"],
      on_start: function (trial) {
        trial.stimulus =
          `<p> You have completed the experiment! </p>
            <p>Your reward will be from the value-based trials.</p>
            <p>One trial was selected at random, and you are rewarded the value of that choice.</p>
            <p>Your reward is $` +
          reward_val_VB +
          `.</p><p>Press the SPACE BAR to continue.</p>`;
      },
    };
    // if (reward_is_VB) {
    //   timeline.push(reward_VB);
    // }

    var if_node_VB = {
      timeline: [reward_VB],
      conditional_function: function () {
        if (reward_is_VB) {
          return true;
        } else {
          return false;
        }
      },
    };

    timeline.push(if_node_VB);

    var reward_FR_correct = {
      type: "html-keyboard-response",
      choices: ["space"],
      on_start: function (trial) {
        trial.stimulus =
          `<p> You have completed the experiment! </p> \
            <p>Your reward will be from the accuracy-based trials.</p>
            <p>One trial was selected at random, which you got correct!</p>
            <p>Your reward is $` +
          acc_reward +
          `.</p><p>Press the SPACE BAR to continue.</p>`;
      },
    };

    var reward_FR_incorrect = {
      type: "html-keyboard-response",
      choices: ["space"],
      on_start: function (trial) {
        trial.stimulus = `<p> You have completed the experiment! </p> \
            <p>Your reward will be from the accuracy-based trials.</p>
            <p>One trial was selected at random, which you unfortunately did not get correct.</p>
            <p>Your reward is $0.</p>
            <p>Press the SPACE BAR to continue.</p>`;
      },
    };

    var reward_FR_is_correct;

    var determine_FR_reward_type = function () {
      if (reward_is_FR) {
        if (final_reward_value == 0) {
          reward_FR_is_correct = false;
        } else {
          reward_FR_is_correct = true;
        }
      }
    };

    var node_FR_reward = {
      type: "call-function",
      func: determine_FR_reward_type,

      //     on_start: function(timeline){
      //         if(reward_FR_is_correct){
      //             timeline.push(reward_FR_correct)
      //         }
      //         if(reward_FR_is_correct == false){
      //             timeline.push(reward_FR_incorrect)
      //         }
      //     },
    };

    if (reward_is_FR) {
      timeline.push(node_FR_reward);
    }

    var if_node = {
      timeline: [reward_FR_correct],
      conditional_function: function () {
        if (reward_FR_is_correct) {
          return true;
        } else {
          return false;
        }
      },
    };

    var if_node_2 = {
      timeline: [reward_FR_incorrect],
      conditional_function: function () {
        if (reward_FR_is_correct == false) {
          return true;
        } else {
          return false;
        }
      },
    };

    timeline.push(if_node);
    timeline.push(if_node_2);

    //log data for demographic info

    timeline.push(cursor_on);

    var demo_trial = {
      type: "survey-text",
      preamble: "<p>Please answer the following demographic questions</p>",
      questions: [
        { prompt: "What is your worker ID?", name: "workerID" },
        { prompt: "What is your age?", name: "Age" },
        {
          prompt:
            "What is your gender identify? (Female/Male/Non-binary/Other/Prefer not to say",
          name: "Gender",
        },
        {
          prompt: "Do you have full color vision? (Yes/No)",
          name: "colorblind",
        },
      ],
    };
    timeline.push(demo_trial);

    jsPsych.init({
      timeline,
      on_finish: function () {
        jsPsych.data.displayData();
        jsPsych.data
          .get()
          .filter([
            { trial_type: "blocks" },
            { trial_type: "blocks-exp" },
            { trial_type: "reward-function" },
            { trial_type: "call" },
            { trial_type: "survey-text" },
          ])
          .ignore("trial_index")
          .ignore("internal_node_id")
          .localSave("csv", "mydata.csv");
        jsPsych.data.addProperties({
          subject: subject_id,
        });
      },
    });
  </script>
</html>
